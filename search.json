[{"title":"Hello World","url":"/2024/08/06/hello-world/","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.\nQuick StartCreate a new post$ hexo new &quot;My New Post&quot;\n\nMore info: Writing\nRun server$ hexo server\n\nMore info: Server\nGenerate static files$ hexo generate\n\nMore info: Generating\nDeploy to remote sites$ hexo deploy\n\nMore info: Deployment\n"},{"title":"快速学会使用django","url":"/2024/08/06/%E5%BF%AB%E9%80%9F%E5%AD%A6%E4%BC%9A%E4%BD%BF%E7%94%A8django/","content":"下面是从零开始开发 Django 项目的完整步骤，包括环境设置、项目配置、Django REST framework (DRF) 的准备工作，以及跨域资源共享 (CORS) 的配置  \n一、环境设置1.1 创建虚拟环境使用 Python 的虚拟环境工具隔离项目的依赖：\npython -m venv venv source venv/bin/activate  # 在 Windows 上使用 &#x27;venv\\Scripts\\activate&#x27; \n\n\n1.2 安装 Django 和 Django REST framework安装 Django 和 Django REST framework（DRF）：\npip install django djangorestframework\n1.3 安装 CORS 支持库安装 django-cors-headers 库以支持跨域资源共享 (CORS)：\npip install django-cors-headers\n1.4 保存依赖项将依赖项保存到 requirements.txt 文件中，方便后续管理和部署：\npip freeze &gt; requirements.txt\n\n\n二、项目配置2.1 创建 Django 项目使用 Django 的命令行工具创建新的项目：\ndjango-admin startproject myproject\n\n2.2 创建 Django 应用在项目目录下创建应用（例如 myapp）：\ncd myprojectpython manage.py startapp myapp\nDjango项目目录结构\n\n\n\n2.3 配置项目设置在 settings.py 中添加应用和 DRF\nINSTALLED_APPS = [    ...    &#x27;rest_framework&#x27;, #添加drf框架    &#x27;myapp&#x27;, #添加应用    &#x27;corsheaders&#x27;,  # 添加 CORS 支持]\n2.4 配置中间件以启用 CORS在 settings.py 中的 MIDDLEWARE 列表中添加 corsheaders.middleware.CorsMiddleware：\nMIDDLEWARE = [    ...    &#x27;corsheaders.middleware.CorsMiddleware&#x27;,    &#x27;django.middleware.common.CommonMiddleware&#x27;,    ...]\n\n2.5 配置 CORS 设置在 settings.py 中添加 CORS 配置：\nCORS_ALLOWED_ORIGINS = [    &quot;http://localhost:3000&quot;,  # 你的前端应用 URL    &quot;https://yourfrontenddomain.com&quot;,  # 生产环境中的前端 URL]\n2.6 设置数据库（默认是 SQLite，可以根据需要修改）：DATABASES = &#123;    &#x27;default&#x27;: &#123;        &#x27;ENGINE&#x27;: &#x27;django.db.backends.sqlite3&#x27;,        &#x27;NAME&#x27;: BASE_DIR / &#x27;db.sqlite3&#x27;,    &#125;&#125;\n\n2.7 配置静态文件\n如有必要）：’DIRS’: [Path(BASE_DIR, ‘templates’)],\n\nSTATIC_URL = &#x27;/static/&#x27;STATICFILES_DIRS=[BASE_DIR,&#x27;static&#x27;]#或者STATICFILES_DIRS = [os.path.join(BASE_DIR, &#x27;static&#x27;)]#STATIC_ROOT=Path(BASE_DIR,&#x27;static&#x27;)#(开发环境不需要，上一行和这一行不能指定为同一个目录)在生产环境时，运行python manage.py collectstatic,django会将所有静态文件拷贝到Static目录中。\n2.8 配置媒体文件（如果需要上传文件）：MEDIA_URL = &#x27;/media/&#x27;MEDIA_ROOT = Path(BASE_DIR, &#x27;media&#x27;)\n2.9 设置语言和时区（根据需要）：# 将 LANGUAGE_CODE 改为中文LANGUAGE_CODE = &#x27;zh-hans&#x27;# 将 TIME_ZONE 改为中国标准时间TIME_ZONE = &#x27;Asia/Shanghai&#x27;\n\n\n2.10 准备 Django REST framework\n配置 DRF，在 settings.py 中添加 DRF 的配置（如果有特定需求）：\n\nREST_FRAMEWORK = &#123;    &#x27;DEFAULT_RENDERER_CLASSES&#x27;: (        &#x27;rest_framework.renderers.JSONRenderer&#x27;,    ),    &#x27;DEFAULT_PARSER_CLASSES&#x27;: (        &#x27;rest_framework.parsers.JSONParser&#x27;,    ),&#125;\n\n三、3.1 创建模型在 myapp&#x2F;models.py 中定义数据模型：\nfrom django.db import modelsclass Word(models.Model):    head_word = models.CharField(max_length=100)    data = models.JSONField()\n\n3.2 创建序列化器在 myapp&#x2F;serializers.py 中定义序列化器：\nfrom rest_framework import serializersfrom .models import Wordclass WordSerializer(serializers.ModelSerializer):    class Meta:        model = Word        fields = &#x27;__all__&#x27;\n\n3.3 创建视图集在 myapp&#x2F;views.py 中定义视图集：\nfrom rest_framework import viewsetsfrom .models import Wordfrom .serializers import WordSerializerclass WordViewSet(viewsets.ModelViewSet):    queryset = Word.objects.all()    serializer_class = WordSerializer\n\n3.4 配置 URL 路由在 myapp&#x2F;urls.py 中配置应用的 URL 路由：\nfrom django.urls import path, includefrom rest_framework.routers import DefaultRouterfrom .views import WordViewSetrouter = DefaultRouter()router.register(r&#x27;words&#x27;, WordViewSet)urlpatterns = [    path(&#x27;&#x27;, include(router.urls)),]\n\n\n\n这个配置将为 Word 模型提供以下 API 端点\n\n\nGET &#x2F;words&#x2F;：获取所有 Word 对象的列表。\nGET &#x2F;words&#x2F;{id}&#x2F;：获取特定 Word 对象的详细信息。\nPOST &#x2F;words&#x2F;：创建一个新的 Word 对象。\nPUT &#x2F;words&#x2F;{id}&#x2F;：更新特定 Word 对象的全部字段。\nPATCH &#x2F;words&#x2F;{id}&#x2F;：部分更新特定 Word 对象的字段。\nDELETE &#x2F;words&#x2F;{id}&#x2F;：删除特定 Word 对象。\n\n3.5 在项目的 myproject&#x2F;urls.py 中包含应用的 URL 路由：from django.contrib import adminfrom django.urls import path, includeurlpatterns = [    path(&#x27;admin/&#x27;, admin.site.urls),    path(&#x27;api/&#x27;, include(&#x27;myapp.urls&#x27;)),#加入api]\n\n\n\n五、数据库初始化和开发5.1 创建数据库表执行迁移命令以创建数据库结构：\npython manage.py makemigrationspython manage.py migrate\n\n5.2 创建超级用户创建一个超级用户来访问 Django 管理后台：\npython manage.py createsuperuser\n\n\n5.3 启动开发服务器启动 Django 开发服务器进行本地开发和测试：\npython manage.py runserver\n\n\n\n通过这些步骤，你可以设置一个 Django 项目，启用Django REST framework进行API开发，并配置跨域资源共享 (CORS) 以允许来自不同源的请求。这将帮助你构建一个功能全面、跨域兼容的应用程序。\n\n六、Django admin后台配置的常用配置#app/admin.pyfrom django.contrib import adminfrom django.db.models.functions import Lowerfrom .models import Word# Register your models here.class WordModelAdmin(admin.ModelAdmin):    list_display = (&#x27;head_word&#x27;,&#x27;trans_pos&#x27;,&#x27;trans_desc&#x27;)    list_editable = [&#x27;trans_desc&#x27;]    readonly_fields = [&#x27;head_word&#x27;]    search_fields = [&#x27;head_word&#x27;]    list_filter = [&#x27;trans_pos&#x27;]#在admin设置排序，只影响admin界面的显示    ordering = (&#x27;head_word&#x27;,)    list_per_page = 5    #若不想默认区分大小写排序，可在模型中的Meta类中修改或者在模型中指定排序#Meta下定义排序将会影响所有通过模型生成的查询集的默认排序    class Meta:        Ordering = [Lower(&#x27;head_word&#x27;)]admin.site.register(Word,WordModelAdmin)\n七7.1 关于json,记住两个常用函数\njson.loads 用于将 JSON 格式的字符串转换为 Python 对象。\n\n\njson.dumps 用于将 Python 对象转换为 JSON 格式的字符串。\n\n\njson.loads 和 json.dumps 是 Python 的 json 模块中的两个核心函数，用于处理 JSON 数据。它们有不同的用途：\n\njson.loads\n\n功能：将 JSON 格式的字符串解析为 Python 对象（如字典、列表）。\n用法：import jsonjson_string = &#x27;&#123;&quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 30, &quot;city&quot;: &quot;New York&quot;&#125;&#x27;data = json.loads(json_string)print(data)# 输出: &#123;&#x27;name&#x27;: &#x27;John&#x27;, &#x27;age&#x27;: 30, &#x27;city&#x27;: &#x27;New York&#x27;&#125;\n\njson.dumps\n\n将 Python 对象转换为 JSON 格式的 字符串。用法：\n\nimport jsondata = &#123;&#x27;name&#x27;: &#x27;John&#x27;, &#x27;age&#x27;: 30, &#x27;city&#x27;: &#x27;New York&#x27;&#125;json_string = json.dumps(data, indent=4, ensure_ascii=False)print(json_string)# 输出:# &#123;#     &quot;name&quot;: &quot;John&quot;,#     &quot;age&quot;: 30,#     &quot;city&quot;: &quot;New York&quot;# &#125;\n\n\n参数：obj：要转换为 JSON 的 Python 对象。indent：用于缩进格式化输出，使 JSON 更易读。ensure_ascii：如果为 False，则允许输出非 ASCII 字符（如中文）。\n\n7.2 限流设置：#限流设置 settings.py全局设置限流访问\n&#x27;DEFAULT_THROTTLE_CLASSES&#x27;: [        &#x27;rest_framework.throttling.AnonRateThrottle&#x27;,        &#x27;rest_framework.throttling.UserRateThrottle&#x27;,    ],    &#x27;DEFAULT_THROTTLE_RATES&#x27;: &#123;        &#x27;anon&#x27;: &#x27;2/min&#x27;,        &#x27;user&#x27;: &#x27;10/min&#x27;    &#125;\n\n\n如果你是匿名用户，当你的每分钟请求数量累计达到2次时，你将看到如下返回信息。如果你是认证用户，你的每分钟请求数量达到10次时才会被限流。局部设置限流\n\nREST_FRAMEWORK = &#123;    &#x27;DEFAULT_THROTTLE_CLASSES&#x27;: [        &#x27;rest_framework.throttling.AnonRateThrottle&#x27;,        &#x27;rest_framework.throttling.UserRateThrottle&#x27;,    ],    &#x27;DEFAULT_THROTTLE_RATES&#x27;: &#123;        &#x27;anon&#x27;: &#x27;2/min&#x27;,        &#x27;user&#x27;: &#x27;10/min&#x27;,        &#x27;limit_per_minute&#x27;:&#x27;5/min&#x27;, # 新增        &#x27;limit_per_hour&#x27;: &#x27;500/hour&#x27;, # 新增    &#125;&#125;\n\n\n\n\nAnonRateThrottle和UserRateThrottle类都是针对单个用户请求进行限流的，而ScopeRateThrottle类是针对不同API接口资源进行限流的，限制的是所有用户对接口的访问总数之和。使用时直接在视图类里通过throttle_scope 属性指定限流范围(scope), 然后在settings.py对不同scope设置限流频率。\n\n例子如下所示：\nclass ArticleListView(APIView):    throttle_scope = &#x27;article_list&#x27;class ArticleDetailView(APIView):        throttle_scope = &#x27;article_detail&#x27;\n\n\n\n\n针对不同api接口设置不同限流频率。如下配置代表文章资源列表一天限1000次请求(所有用户访问数量之和)，文章详情接口限1小时100次。\n\nREST_FRAMEWORK = &#123;    &#x27;DEFAULT_THROTTLE_CLASSES&#x27;: [        &#x27;rest_framework.throttling.AnonRateThrottle&#x27;,        &#x27;rest_framework.throttling.UserRateThrottle&#x27;,        &#x27;rest_framework.throttling.ScopedRateThrottle&#x27;,    ],    &#x27;DEFAULT_THROTTLE_RATES&#x27;: &#123;        &#x27;anon&#x27;: &#x27;2/min&#x27;,        &#x27;user&#x27;: &#x27;10/min&#x27;,        &#x27;article_list&#x27;:&#x27;1000/day&#x27;, # 新增                &#x27;article_detail&#x27;: &#x27;100/hour&#x27;, # 新增            &#125;  &#125;\n\n","categories":["Django"],"tags":["django","python"]}]